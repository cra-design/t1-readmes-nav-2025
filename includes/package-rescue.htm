<section id="rescue-en">
  <!-- Dynamic sentence (hidden until we have params) -->
  <p id="dnmc-rsc" class="wb-inv">
    To find other <span id="rsc-year"></span> forms or guides you may need
    <span id="rsc-for" class="wb-inv">for <span id="rsc-prov"></span></span>,
    return to the
    <a id="rsc-link" href="#">
      <span id="rsc-link-year"></span> Income tax package <span id="rsc-link-prov"></span>
    </a>.
  </p>

  <script>
    (function () {
      // Wait until WET finished booting so DOM is stable
      document.addEventListener("wb-ready.wb", function () {
        try {
          var url = new URL(window.location.href);
          // Your pages sometimes use ?year= and ?pkgyr=; prefer pkgyr for the package link
          var year = url.searchParams.get("pkgyr") || url.searchParams.get("year");
          var prov = (url.searchParams.get("prov") || "").toLowerCase();

          if (!year) return; // keep sentence hidden when no year

          // Province names + slugs for the URL path
          var PROV = {
            ab: { name: "Alberta",                   slug: "alberta" },
            bc: { name: "British Columbia",          slug: "british-columbia" },
            mb: { name: "Manitoba",                  slug: "manitoba" },
            nb: { name: "New Brunswick",             slug: "new-brunswick" },
            nl: { name: "Newfoundland and Labrador", slug: "newfoundland-and-labrador" },
            ns: { name: "Nova Scotia",               slug: "nova-scotia" },
            nt: { name: "Northwest Territories",     slug: "northwest-territories" },
            nu: { name: "Nunavut",                   slug: "nunavut" },
            on: { name: "Ontario",                   slug: "ontario" },
            pe: { name: "Prince Edward Island",      slug: "prince-edward-island" },
            qc: { name: "Quebec",                    slug: "quebec" },
            sk: { name: "Saskatchewan",              slug: "saskatchewan" },
            yt: { name: "Yukon",                     slug: "yukon" },
            nr: { name: "non-residents",             slug: "non-residents" }
          };

          // Elements
          var wrap      = document.getElementById("dnmc-rsc");
          var yearTxt   = document.getElementById("rsc-year");
          var forWrap   = document.getElementById("rsc-for");
          var provTxt   = document.getElementById("rsc-prov");
          var link      = document.getElementById("rsc-link");
          var linkYear  = document.getElementById("rsc-link-year");
          var linkProv  = document.getElementById("rsc-link-prov");

          // Fill year text
          yearTxt.textContent  = year;
          linkYear.textContent = year;

          // Default: year-level package link
          var href = "archived-general-income-tax-benefit-package-" + year + ".html";

          // If prov provided and recognized, show province phrasing + point link to province page
          if (prov && PROV[prov]) {
            var p = PROV[prov];
            // Show "for {Province}"
            forWrap.classList.remove("wb-inv");
            provTxt.textContent = p.name;
            linkProv.textContent = "for " + p.name;

            // Province-level href
            href = "archived-general-income-tax-benefit-package-" + year + "/" + p.slug + ".html";
          } else {
            // No province: ensure the province bit stays hidden and link has no trailing "for â€¦"
            forWrap.classList.add("wb-inv");
            linkProv.textContent = "";
          }

          // Apply final href
          link.setAttribute("href", href);

          // Finally, reveal the sentence
          wrap.classList.remove("wb-inv");
        } catch (e) {
          // If anything goes wrong, keep it hidden to avoid broken UI
          // console.warn("rescue sentence init failed", e);
        }
      });
    })();
  </script>
</section>
